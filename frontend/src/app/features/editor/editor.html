<div class="editor-wrapper">
  <!-- Toolbar -->
  <mat-toolbar color="primary" class="editor-toolbar">
    <div class="toolbar-content">
      <div class="toolbar-left">
        <span class="document-title">{{ docId() }}</span>
        @if (!isEditable()) {
        <div class="view-only-badge">
          <mat-icon>visibility</mat-icon>
          <span>View Only</span>
        </div>
        }
        <div class="connection-badge" [class]="signalRService.connectionState()">
          <mat-icon class="status-icon">
            @if (signalRService.connectionState() === 'connected') { check_circle } @else {
            radio_button_unchecked }
          </mat-icon>
          <span>{{ signalRService.connectionState() }}</span>
        </div>
        @if (signalRService.activeUserCount() > 0) {
        <div class="active-users">
          <mat-icon>people</mat-icon>
          <span>{{ signalRService.activeUserCount() }} active</span>
        </div>
        }
      </div>

      <div class="toolbar-right">
        <button mat-icon-button (click)="downloadCode()" matTooltip="Download">
          <mat-icon>download</mat-icon>
        </button>
        <button mat-icon-button (click)="toggleTheme()" matTooltip="Toggle Theme">
          <mat-icon>{{ isDarkMode() ? 'light_mode' : 'dark_mode' }}</mat-icon>
        </button>
        <button mat-icon-button (click)="copyCode()" matTooltip="Copy Code">
          <mat-icon>content_copy</mat-icon>
        </button>
      </div>
    </div>
  </mat-toolbar>

  <!-- Editor -->
  <div class="editor-container">
    <div class="line-numbers-wrapper" [class.dark-theme]="isDarkMode()">
      <pre class="line-numbers" #lineNumbers>{{ getLineNumbers() }}</pre>
    </div>
    <textarea
      #codeTextarea
      class="code-editor"
      [class.dark-theme]="isDarkMode()"
      [class.readonly]="!isEditable()"
      [readonly]="!isEditable()"
      spellcheck="false"
    ></textarea>
  </div>
</div>
